# Internationalization (i18n)

This document covers the translation system for the DCC system.

## Overview

The DCC system uses FoundryVTT's built-in internationalization system. All user-facing text should be translated, never hardcoded.

## Language Files

### Location
```
lang/
├── en.json    # English (reference)
├── cn.json    # Chinese
├── de.json    # German
├── es.json    # Spanish
├── fr.json    # French
├── it.json    # Italian
└── pl.json    # Polish
```

### Reference File
`lang/en.json` is the **primary reference file**. All other language files should have matching keys.

## Key Format

Translation keys use nested objects with dot notation:

```json
{
  "DCC": {
    "Settings": {
      "AutomateClericDisapproval": "Automate Cleric Disapproval",
      "AutomateWizardSpellLoss": "Automate Wizard Spell Loss"
    },
    "AbilityStr": "Strength",
    "AbilityAgl": "Agility"
  }
}
```

Access in code: `game.i18n.localize('DCC.Settings.AutomateClericDisapproval')`

## Adding New Translations

### Step 1: Add to English First
Always add new keys to `lang/en.json` first:

```json
{
  "DCC": {
    "NewFeature": {
      "Title": "New Feature Title",
      "Description": "Description of the new feature"
    }
  }
}
```

### Step 2: Translate to Other Languages
When adding keys to other language files, **always translate them**. Never leave English text in non-English files.

```json
// lang/de.json
{
  "DCC": {
    "NewFeature": {
      "Title": "Neuer Funktionsname",
      "Description": "Beschreibung der neuen Funktion"
    }
  }
}
```

### Step 3: Verify Coverage
Run the comparison tool to check for missing keys:

```bash
# Compare all languages against English
npm run compare-lang

# Compare specific language files
node module/compare-lang-files.js lang/en.json lang/de.json
```

## Using Translations in Code

### JavaScript
```javascript
// Simple localization
const label = game.i18n.localize('DCC.AbilityStr')

// With formatting
const message = game.i18n.format('DCC.RollResult', {
  actor: actorName,
  result: rollTotal
})
```

### Handlebars Templates
```handlebars
{{!-- Simple localization --}}
<label>{{localize "DCC.AbilityStr"}}</label>

{{!-- With context --}}
<span>{{localize label}}</span>
```

## Best Practices

### Do
- Use descriptive key names that indicate context
- Group related keys under common prefixes
- Keep translations consistent in tone and terminology
- Test UI with longer translations (German text is often longer than English)

### Don't
- Hardcode user-facing strings
- Leave untranslated text in language files
- Use abbreviations without context
- Split sentences across multiple keys (word order varies by language)

## Common Key Prefixes

| Prefix | Usage |
|--------|-------|
| `DCC.Ability*` | Ability score names |
| `DCC.Class*` | Character class names |
| `DCC.Settings.*` | System settings |
| `DCC.Sheet*` | Sheet labels |
| `DCC.Roll*` | Roll-related text |
| `DCC.Dialog*` | Dialog titles/buttons |

## Adding a New Language

When adding support for a completely new language (not just updating an existing translation):

### Step 1: Create the Language File
Create a new JSON file in `lang/` named with the appropriate language code (e.g., `ja.json` for Japanese).

### Step 2: Register in Manifest Files
Add the language to the `languages` array in **both** manifest files:

**system.json** and **latest.json**:
```json
{
  "languages": [
    // ... existing languages ...
    {
      "lang": "ja",
      "name": "日本語",
      "path": "lang/ja.json"
    }
  ]
}
```

The `lang` code should match the filename (without `.json`). The `name` should be the language name in its native script.

### Step 3: Translate All Keys
Copy the structure from `en.json` and translate all keys. Use `npm run compare-lang` to verify complete coverage.

## Contribution Guidelines

When contributing translations:

1. **Copy structure from English**: Ensure your file has the same key structure as `en.json`
2. **Translate all new keys**: Don't commit partial translations
3. **Test in Foundry**: Verify translations display correctly
4. **Check for overflow**: Ensure long translations fit in UI elements
5. **Run comparison**: Use `npm run compare-lang` to verify coverage

## Related Documentation

- [Development Guide](DEVELOPMENT.md) - Development workflow
- [FoundryVTT Localization](https://foundryvtt.com/article/localization/) - Official docs
